<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ–Ω–Ω–∏—Å–Ω—ã–µ –∫–æ—Ä—Ç—ã –ú–æ—Å–∫–≤—ã</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        /* ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–≤–µ—Ç–ª–æ–π –∏ —Ç—ë–º–Ω–æ–π —Ç–µ–º—ã */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Arial', sans-serif;
            transition: background 0.3s ease, color 0.3s ease;
        }

        /* ‚úÖ –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ */
        #controls {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 10px;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            transition: background 0.3s ease, border-bottom 0.3s ease;
        }

        /* ‚úÖ –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "üìç –ù–∞–π—Ç–∏ –º–µ–Ω—è" */
        #location-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        #location-btn:hover {
            background-color: #0056b3;
        }

        /* ‚úÖ –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
        select, button {
            font-size: 16px;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        /* ‚úÖ –ß–µ–∫–±–æ–∫—Å—ã —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º —Å—Ç–∏–ª–µ–º */
        .checkbox-container {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 16px;
        }

        .custom-checkbox {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #007bff;
            border-radius: 5px;
            margin-right: 5px;
            position: relative;
        }

        input[type="checkbox"] {
            display: none;
        }

        input[type="checkbox"]:checked + .custom-checkbox {
            background-color: #007bff;
        }

        input[type="checkbox"]:checked + .custom-checkbox::after {
            content: '‚úî';
            color: white;
            position: absolute;
            left: 5px;
            top: 2px;
            font-size: 14px;
        }

        /* ‚úÖ –ö–∞—Ä—Ç–∞ */
        #map {
            width: 100%;
            height: calc(100vh - 60px);
            margin-top: 60px;
        }
    </style>
</head>
<body>

    <!-- ‚úÖ Telegram Web App API -->
    <script>
        if (window.Telegram && Telegram.WebApp) {
            Telegram.WebApp.expand();
            Telegram.WebApp.ready();

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫–∞—è —Ç–µ–º–∞ —É Telegram
            const theme = Telegram.WebApp.colorScheme;
            if (theme === "dark") {
                document.body.style.backgroundColor = "#222";
                document.body.style.color = "#fff";
                document.querySelector("#controls").style.background = "#333";
                document.querySelector("#controls").style.borderBottom = "2px solid #555";
            } else {
                document.body.style.backgroundColor = "#fff";
                document.body.style.color = "#000";
                document.querySelector("#controls").style.background = "#fff";
                document.querySelector("#controls").style.borderBottom = "2px solid #ddd";
            }
        }
    </script>

    <div id="controls">
        <button id="location-btn" onclick="getLocation()">üìç –ù–∞–π—Ç–∏ –º–µ–Ω—è</button>

        <select id="surface-filter" onchange="applyFilters()">
            <option value="all">üéæ –õ—é–±–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ</option>
            <option value="hard">üõ† –•–∞—Ä–¥</option>
            <option value="clay">üèú –ì—Ä—É–Ω—Ç</option>
            <option value="grass">üå± –¢—Ä–∞–≤–∞</option>
        </select>

        <label class="checkbox-container">
            <input type="checkbox" id="lights-filter" onclick="applyFilters()">
            <span class="custom-checkbox"></span> üí° –û—Å–≤–µ—â–µ–Ω–∏–µ
        </label>

        <label class="checkbox-container">
            <input type="checkbox" id="locker-filter" onclick="applyFilters()">
            <span class="custom-checkbox"></span> üöø –†–∞–∑–¥–µ–≤–∞–ª–∫–∏
        </label>
    </div>

    <div id="map"></div>

    <script>
        var map = L.map('map').setView([55.751244, 37.618423], 11); // –ú–æ—Å–∫–≤–∞

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        var courts = [
            { name: "–ü–∞—Ä–∫ –ì–æ—Ä—å–∫–æ–≥–æ", lat: 55.7308, lon: 37.6034, info: "–û—Ç–∫—Ä—ã—Ç—ã–π –∫–æ—Ä—Ç", surface: "hard", lights: true, locker: false },
            { name: "–õ—É–∂–Ω–∏–∫–∏", lat: 55.7158, lon: 37.5537, info: "–ö—Ä—ã—Ç—ã–µ –∫–æ—Ä—Ç—ã", surface: "clay", lights: true, locker: true },
            { name: "–°–æ–∫–æ–ª—å–Ω–∏–∫–∏", lat: 55.7942, lon: 37.6742, info: "–û—Ç–∫—Ä—ã—Ç—ã–µ –∫–æ—Ä—Ç—ã", surface: "grass", lights: false, locker: false },
            { name: "–§–∏–ª–µ–≤—Å–∫–∏–π –ø–∞—Ä–∫", lat: 55.7451, lon: 37.4673, info: "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫–æ—Ä—Ç—ã", surface: "hard", lights: true, locker: true }
        ];

        var userMarker;
        var courtMarkers = [];

        function addCourts(filteredCourts = courts) {
            courtMarkers.forEach(marker => map.removeLayer(marker));
            courtMarkers = [];

            filteredCourts.forEach(court => {
                let marker = L.marker([court.lat, court.lon])
                    .addTo(map)
                    .bindPopup(`<b>${court.name}</b><br>${court.info}<br><b>–ü–æ–∫—Ä—ã—Ç–∏–µ:</b> ${court.surface}<br><b>–û—Å–≤–µ—â–µ–Ω–∏–µ:</b> ${court.lights ? "–ï—Å—Ç—å" : "–ù–µ—Ç"}<br><b>–†–∞–∑–¥–µ–≤–∞–ª–∫–∏:</b> ${court.locker ? "–ï—Å—Ç—å" : "–ù–µ—Ç"}<br><a href="court.html?name=${court.name}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>`);
                courtMarkers.push(marker);
            });
        }

        addCourts();

        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const userLat = position.coords.latitude;
                    const userLon = position.coords.longitude;

                    if (userMarker) {
                        map.removeLayer(userMarker);
                    }

                    map.setView([userLat, userLon], 14);

                    userMarker = L.marker([userLat, userLon], { icon: L.icon({ iconUrl: 'https://cdn-icons-png.flaticon.com/512/447/447031.png', iconSize: [30, 30] }) })
                        .addTo(map)
                        .bindPopup("–í—ã –∑–¥–µ—Å—å! üìç").openPopup();
                });
            }
        }

        function applyFilters() {
            let selectedSurface = document.getElementById("surface-filter").value;
            let filterLights = document.getElementById("lights-filter").checked;
            let filterLocker = document.getElementById("locker-filter").checked;

            let filteredCourts = courts.filter(court => {
                let matchesSurface = (selectedSurface === "all" || court.surface === selectedSurface);
                let matchesLights = (!filterLights || court.lights);
                let matchesLocker = (!filterLocker || court.locker);
                return matchesSurface && matchesLights && matchesLocker;
            });

            addCourts(filteredCourts);
        }
    </script>

</body>
</html>
